<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<form id="contact-form">
  <div class="contact-us" id="contact_us">
    <div class="form-container" data-inputs>
      <span class="form-title" tabindex="0">¿Charlamos?</span>
      <div class="form-input-box" data-inputs>
        <div class="form-input-container" data-inputs>
          <div class="form-names-box" data-inputs>
            <label class="form-names" for="contact-name">Nombre</label>
            <input type="text" id="contact-name" aria-label="Nombre" class="form-input" required>
            <div class="error-message" id="error-name"></div>
          </div>
          <div class="form-names-box" data-inputs>
            <label class="form-names" for="contact-email">Correo o Teléfono</label>
            <input type="text" id="contact-email" aria-label="Correo o Teléfono" class="form-input" required>
            <div class="error-message" id="error-email"></div>
          </div>
        </div>
        <div class="form-message-input-container" data-inputs>
          <label class="form-names" for="contact-message">Mensaje</label>
          <textarea id="contact-message" aria-label="Mensaje" class="form-input" placeholder="¿En qué te puedo ayudar?" required></textarea>
          <div class="error-message" id="error-message"></div>
        </div>
        <div class="form-rgpd-box" data-inputs>
          <div class="row">
            <input type="checkbox" id="contact-rgpd" required>
            <label for="contact-rgpd" class="rgpd">He leído y acepto la <a class="md-link" target="_blank" href="/legal/politica-de-privacidad">política de privacidad</a></label>
          </div>
        </div>
      </div>
      <div class="title-div-under" data-inputs>
        <button type="submit" class="cta shadow button_under">ENVIAR</button>
      </div>
    </div>
    <div id="form-status" class="my-12 text-8 py-3 px-5"></div>
  </div>
</form>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    emailjs.init("hjKrCI6RRjy4D7bn_");

    const form = document.getElementById("contact-form");
    const status = document.getElementById("form-status");

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const name = document.getElementById("contact-name");
      const email = document.getElementById("contact-email");
      const message = document.getElementById("contact-message");
      const rgpd = document.getElementById("contact-rgpd");

      let valid = true;

      // Validaciones básicas
      if (!name.value.trim()) {
        document.getElementById("error-name").textContent = "El nombre no puede estar vacío";
        valid = false;
      } else {
        document.getElementById("error-name").textContent = "";
      }

      if (!email.value.trim()) {
        document.getElementById("error-email").textContent = "El correo o teléfono no puede estar vacío";
        valid = false;
      } else {
        document.getElementById("error-email").textContent = "";
      }

      if (!message.value.trim()) {
        document.getElementById("error-message").textContent = "El mensaje no puede estar vacío";
        valid = false;
      } else {
        document.getElementById("error-message").textContent = "";
      }

      if (!rgpd.checked) {
        alert("Debes aceptar la política de privacidad.");
        valid = false;
      }

      if (!valid) return;

      // Animación de envío
      const submitBtn = form.querySelector('button[type="submit"]');
      const formContainer = document.querySelector('.form-container');
      
      submitBtn.disabled = true;
      submitBtn.textContent = "ENVIANDO...";
      submitBtn.classList.add('sending');
      formContainer.classList.add('form-sending');

      const params = {
        name: name.value,
        email: email.value,
        message: message.value,
      };

      emailjs.send("service_gs1moco", "template_fcs5nzm", params)
        .then(() => {
          formContainer.classList.remove('form-sending');
          formContainer.classList.add('form-success');
          
          status.textContent = "¡Mensaje enviado correctamente! ✅";
          status.style.color = "var(--color-primary)";
          status.classList.add('status-show', 'status-success');
          
          setTimeout(() => {
            form.reset();
            submitBtn.disabled = false;
            submitBtn.textContent = "ENVIAR";
            submitBtn.classList.remove('sending');
            formContainer.classList.remove('form-success');
            status.classList.remove('status-show', 'status-success');
          }, 3000);
        })
        .catch((err) => {
          formContainer.classList.remove('form-sending');
          formContainer.classList.add('form-error');
          
          status.textContent = "Error al enviar el mensaje ❌";
          status.style.color = "#dc2626";
          status.classList.add('status-show', 'status-error');
          
          submitBtn.disabled = false;
          submitBtn.textContent = "ENVIAR";
          submitBtn.classList.remove('sending');
          
          setTimeout(() => {
            formContainer.classList.remove('form-error');
            status.classList.remove('status-show', 'status-error');
          }, 3000);
          
          console.error(err);
        });
    });
  });
</script>

<style lang="scss">
.contact-us {
  background: linear-gradient(
    180deg,
    #f2f2f2 0%,
    #e0e0e0 15%,
    #2b2a2f 100%
  );
  min-height: 80vh;
  color: #fff;
  padding: 80px 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.form-input {
  box-sizing: border-box;
  border: 2px solid transparent;
  transition: border-color 0.3s ease-in-out;
}

.input-error {
  border-color: var(--color-error);
}

.error-message {
  color: var(--color-error);
  font-size: 14px;
  margin-top: 4px;
  height: 18px;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.error-message.show-error {
  opacity: 1;
  visibility: visible;
}

.form-container {
  max-width: 700px;
  width: 100%;
  margin: 0 auto;
  background: #ffffff;
  border-radius: 20px;
  padding: 50px 40px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  border: 1px solid #e0e0e0;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

  &.form-sending {
    opacity: 0.7;
    transform: scale(0.98);
    pointer-events: none;
  }

  &.form-success {
    animation: successPulse 0.6s ease-out;
    border-color: var(--color-primary);
    box-shadow: 0 10px 40px rgba(33, 135, 76, 0.3);
  }

  &.form-error {
    animation: errorShake 0.5s ease-out;
    border-color: #dc2626;
  }
}

@keyframes successPulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
  }
}

@keyframes errorShake {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-10px);
  }
  75% {
    transform: translateX(10px);
  }
}

.form-title {
  color: var(--color-header);
  font-size: 36px;
  font-weight: 700;
  text-align: center;
  padding: 0;
  margin-bottom: 30px;
  position: relative;

  &::after {
    content: '';
    display: block;
    width: 60px;
    height: 4px;
    margin: 16px auto 0;
    border-radius: 2px;
  }
}

.form-input-box {
      box-sizing: inherit;
    justify-content: center;
}

.title-div-under {
      box-sizing: inherit;
    display: flex;
    justify-content: center;
}

.form-input-container {
  display: flex;
  align-items: flex-end;
  flex-direction: row;
  gap: 20px;
  margin-bottom: 20px;
}

.form-names-box {
  flex: 1;
}
.form-message-input-container {
  margin-bottom: 20px;

  textarea {
    width: 100%;
    resize: none;
  }
}

.form-rgpd-box{
    box-sizing: inherit;
    margin-top: -20px;
    margin-bottom: 20px;
}

.form-names{
    box-sizing: inherit;
    color: var(--color-header);
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 8px;
    display: block;
}

.form-input {
  width: 100%;
  background-color: #f8f9fa;
  border-radius: 10px;
  border: 2px solid #e0e0e0;
  padding: 14px 18px;
  margin-top: 8px;
  color: var(--color-header);
  font-size: 15px;
  transition: all 0.3s ease;
  font-family: inherit;

  &:focus {
    outline: none;
    border-color: var(--color-primary);
    background-color: #fff;
    box-shadow: 0 0 0 3px rgba(33, 135, 76, 0.1);
  }

  &::placeholder {
    color: #999;
  }
}

#error-message {
  margin-bottom: 30px !important;
}

.row{
      box-sizing: inherit;
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 10px;
}
.rgpd {
  color: var(--color-header);
  font-size: 14px;
  
  a {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 600;
    border-bottom: 1px solid var(--color-primary);
    transition: all 0.3s ease;

    &:hover {
      color: var(--color-link-hover);
      border-bottom-color: var(--color-link-hover);
    }
  }
}

input[type="checkbox"] {
  accent-color: var(--color-primary);
  width: 20px;
  height: 20px;
  cursor: pointer;
  transition: transform 0.2s ease;

  &:hover {
    transform: scale(1.1);
  }
}

.cta.button_under {
  background: linear-gradient(135deg, var(--color-primary) 0%, #1a8a52 100%);
  color: #fff;
  font-size: 16px;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  padding: 16px 40px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(33, 135, 76, 0.3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;

  &:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(33, 135, 76, 0.4);
    background: linear-gradient(135deg, #1a8a52 0%, var(--color-primary) 100%);
  }

  &:active:not(:disabled) {
    transform: translateY(0);
  }

  &.sending {
    background: linear-gradient(135deg, #999 0%, #666 100%);
    cursor: not-allowed;
    animation: pulse 1.5s ease-in-out infinite;
  }

  &:disabled {
    cursor: not-allowed;
    opacity: 0.7;
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

#form-status {
  opacity: 0;
  transform: translateY(-10px);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  text-align: center;
  font-weight: 600;
  font-size: 16px;
  padding: 16px;
  border-radius: 10px;
  margin-top: 20px;

  &.status-show {
    opacity: 1;
    transform: translateY(0);
  }

  &.status-success {
    background: rgba(33, 135, 76, 0.1);
    border: 2px solid var(--color-primary);
  }

  &.status-error {
    background: rgba(220, 38, 38, 0.1);
    border: 2px solid #dc2626;
  }
}

.form-container {
  max-width: 700px;
  width: 100%;
  margin: 0 auto;
  background: #ffffff;
  border-radius: 20px;
  padding: 50px 40px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  border: 1px solid #e0e0e0;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

  &.form-sending {
    opacity: 0.7;
    transform: scale(0.98);
    pointer-events: none;
  }

  &.form-success {
    animation: successPulse 0.6s ease-out;
    border-color: var(--color-primary);
    box-shadow: 0 10px 40px rgba(33, 135, 76, 0.3);
  }

  &.form-error {
    animation: errorShake 0.5s ease-out;
    border-color: #dc2626;
  }
}

.form-names-box{
  width: 100%;
}

@media screen and (max-width: 767px) {
  .form-container {
    width: auto;
  }

  .form-input-container {
    display: flex;
    align-items: flex-end;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 20px;
  }
}
